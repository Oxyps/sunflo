drop table ServicoProduto;
drop table FuncionarioServico;
drop table FuncionarioAgendaCliente;
drop table Servico;
drop table Produto;
drop table Cliente;
drop table Estoque;
drop table Funcionario;
drop table Agenda;

create table Cliente(
	cpf varchar(11) primary key not null,
	nome varchar(60) not null,
	telefone char(11) not null,
	endereco varchar(80) not null,
	email varchar(60) unique not null,
	nascimento Date not null
);

create table Funcionario(
	password varchar(12) not null,
	nome varchar(60) not null,
	nascimento date not null,
	email varchar(60) unique,
	endereco varchar(80),
	cpf varchar(11) primary key not null,
	telefone char(11) not null,
	atuacaoProfissional varchar(60),
	grauEscolaridade varchar(60) not null
);

create table Servico(
	codServico serial primary key,
	nome varchar(60),
	descricao varchar(80)
);

create table Estoque(
	codEstoque serial primary key,
	nome varchar(60)
);

create table Produto(
	codProduto serial primary key,
	nome varchar(60),
	descricao varchar(80),
	quantidadeMinima int,
	quantidadeAtual int,
	codEstoque int,
	valor decimal,
	
	constraint FK_ProdutoEstoque foreign key(codEstoque) references estoque(codEstoque) on update cascade on delete set null
);

create table FuncionarioServico(
	cpfFuncionario varchar(11),
	codServico int,
	
	constraint FK_FS_Funcionario foreign key(cpfFuncionario) references Funcionario(cpf) on update cascade on delete set null,
	constraint FK_FS_Servico foreign key(codServico) references Servico(codServico) on update cascade on delete set null
);

create table ServicoProduto(
	codServico int,
	codProduto int,
	valorServico decimal primary key,
	valorAjuste decimal,
	valorPromocional decimal,
	
	constraint FK_SP_Servico foreign key(codServico) references Servico(codServico) on update cascade on delete set null,
	constraint FK_SP_Produto foreign key(codProduto) references Produto(codProduto) on update cascade on delete set null
);

create table Agenda(
	data date unique,
	horario time unique
);

create table FuncionarioAgendaCliente(
	cpfFuncionario varchar(11),
	cpfCliente varchar(11),
	data date,
	horario time,
	codServico int,
	status varchar(35),
	
	constraint FK_FAC_Funcionario foreign key(cpfFuncionario) references Funcionario(cpf) on update cascade on delete set null,
	constraint FK_FAC_Cliente foreign key(cpfCliente) references Cliente(cpf) on update cascade on delete cascade,
	constraint FK_FAC_AgendaData foreign key(data) references Agenda(data) on update cascade on delete cascade,
	constraint FK_FAC_AgendaHorario foreign key(horario) references Agenda(horario) on update cascade on delete cascade,
	constraint FK_FAC_Servico foreign key(codServico) references Servico(codServico) on update cascade on delete set null
);
